<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TOA DataSync</title>
    <link href="assets/css/styles.css" rel="stylesheet">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/material-components-web@2.2.0/material-components-web.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" >
</head>
<body>
<header class="toa-toolbar"></header>
<div class="center-spin">
    <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>

<script src="assets/material-components-web@2.2.0/material-components-web.min.js"></script>
<script>
    require('./assets/js/menu.js');

    const { firebase } = require('./assets/js/firebase.js');
    const { BrowserWindow } = require('electron').remote;
    const { platform } = require('os');
    firebase.auth().onAuthStateChanged((user) => {
        const ipAddress = localStorage.getItem('SCOREKEEPER-IP');
        const events = JSON.parse(localStorage.getItem('CONFIG-EVENTS'));
        if (!ipAddress) {
            return location.href = './setup-pages/step1.html';
        } else if (ipAddress && !events) {
            return location.href = './setup-pages/step2.html';
        } else if (ipAddress && events && !user) {
            return location.href = './setup-pages/step3.html';
        } else if (ipAddress && events && user) {
            for (const event of events) {
                if (!event.toa_event_key || !event.toa_api_key) {
                    return location.href = './setup-pages/step4.html';
                }
            }

            // SETUP DONE :)
            for (let i = 1; i < events.length; i++) {
                const win = new BrowserWindow({
                    frame: platform() === 'darwin',
                    width: 500,
                    height: 640,
                    x: i % 2 === 0 ? 0 : screen.width - 500,
                    y: (screen.height - 640) / 2,
                    resizable: false,
                    titleBarStyle : 'hiddenInset',
                    maximizable: false,
                    fullscreenable: false,
                    webPreferences: {
                        nodeIntegration: true
                    }
                });
                win.loadURL(`file://${__dirname}/sync.html?i=${i}`)
            }
            return location.href = './sync.html?i=0';
        }
    });
</script>
</body>
</html>
